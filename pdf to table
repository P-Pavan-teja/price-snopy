import tabula
import pandas as pd

pdf_path = "input.pdf"
start_page = 5
end_page = 12
page_range = f"{start_page}-{end_page}"

dfs = tabula.read_pdf(pdf_path, pages=page_range, multiple_tables=True, guess=True)
if not dfs:
    raise ValueError("No tables extracted")

# Combine first
combined = pd.concat(dfs, ignore_index=True)
combined = combined.dropna(how="all").reset_index(drop=True)

# If Tabula gives generic column names, the first row may actually be the header
# We'll take the first row as "true header" only if columns look like Unnamed / 0,1,2...
generic_cols = all(str(c).isdigit() or str(c).lower().startswith("unnamed") for c in combined.columns)

if generic_cols and len(combined) > 0:
    new_header = combined.iloc[0].astype(str).tolist()
    combined = combined.iloc[1:].copy()
    combined.columns = new_header
    combined = combined.reset_index(drop=True)

# Now drop repeated header rows inside the data
header_values = [str(c).strip().lower() for c in combined.columns]

def is_repeated_header_row(row):
    row_vals = [str(x).strip().lower() for x in row.tolist()]
    return row_vals == header_values

combined = combined[~combined.apply(is_repeated_header_row, axis=1)].reset_index(drop=True)

display(combined)
